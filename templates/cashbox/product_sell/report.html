{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label='cashbox' %}">Касса</a>
&rsaquo; <a href="/admin/cashbox/productsell/">Продажи</a>
&rsaquo; {{ 'Отчет по продажам' }}
</div>
{% endblock %}

{% block content %}
    {% if access_error %}
        <h1>Ошибка доступа</h1>
    {% else %}
    <span>Фильтр</span>
    <ul>
        <li><a href="{% url 'product_sell_report_view' %}?period_type=day">За текущий день</a></li>
        <li><a href="{% url 'product_sell_report_view' %}?period_type=month">За текущий месяц</a></li>
        <li>
            <form action="{% url 'product_sell_report_view' %}" id="form_period" method="get">
                <span>За период с </span><input name="period_start" type="date" required pattern="\d{1,2}.\d{1,2}.\d{4}"/>
                по <input name="period_end" type="date" required pattern="\d{1,2}.\d{1,2}.\d{4}"/>
                <input hidden name="period_type" value="period">
                <input type="submit">
            </form>
        </li>
    </ul>
    </h1>
    <h1>{{ report }}</h1>
    <ul>
        <li><b>Отчет для - {{ report.user }}</b></li>
    </ul>
    <table id="product-sell-report">
        <caption>Список продаж</caption>
        <thead>
            <th>№</th>
            <th>Дата продажи</th>
            <th>Покупатель</th>
            <th>Сумма продажи</th>
            <th>Скидка</th>
        </thead>
        <tbody>
            {% for sell in report.sells %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td><a href="{% url 'product_sell_view' sell.id %}">{{ sell.get_verbose_sell_date }}</a></td>
                <td>{{ sell.customer.customer_type.type_name }} / {{ sell.customer }}</td>
                <td>{{ sell.get_sell_amount }}</td>
                <td>{{ sell.get_rebate_amount }}</td>
            </tr>
            {% endfor %}
            <tr>
                <td></td>
                <td><b>Итого</b></td>
                <td><b>{{ report.total_amount|round_number:"2" }}</b></td>
                <td><b>{{ report.total_rebate_amount|round_number:"2" }}</b></td>
            </tr>
        </tbody>
    </table>

    </br>
    <h1>Произведенно оплат на сумму</h1>
    <ul>
        {% for key in report.payments %}
            <li>{{ key }} - {{ report.payments|get_item:key }} руб.</li>
        {% endfor %}
    </ul>
    {% endif %}
    <input type="button" value="Назад" onclick="window.location='/admin/cashbox/productsell/';">

{% endblock %}