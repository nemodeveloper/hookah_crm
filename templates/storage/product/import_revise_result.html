{% extends "admin/base_site.html" %}
{% load i18n admin_static %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label='storage' %}">{{ 'Склад' }}</a>
&rsaquo; <a href="/admin/storage/revise/import/">Сверка товара</a>
&rsaquo; {{ 'Результат загрузки файла сверки' }}
</div>
{% endblock %}

{% block content %}
    {% if errors %}
        <h1>При загрузке файла произошли ошибки!</h1>
        <ul>
            <li>Исправьте ошибки в файле и попытайтесь загрузить файл еще раз!</li>
            <li>Во избежание дополнительных ошибок рекомендуется сформировать новый файл не содержащий ошибок!</li>
        </ul>
        <span>Ошибки возникшие при загрузке файла:</span>
        <ul>
            {% for error in errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
        <a href="{% url 'revise_import_view' %}">Вернуться к загрузке файла сверки</a>
    {% else %}
        <h1>Загрузка сверки прошла успешно!</h1>
        <ul>
            <li>Сверку совершил {{ revise.owner }}</li>
            <li>Сверка от {{ revise.revise_date|format_date:"" }}</li>
        </ul>
        <table>
            <thead>
                <th>№</th>
                <th>Группа</th>
                <th>Категория</th>
                <th>Вид</th>
                <th>Наименование</th>
                <th>В системе(шт)</th>
                <th>На складе(шт)</th>
                <th>Себестоимость(руб)</th>
                <th>Розница(руб)</th>
                <th>Заведения(руб)</th>
                <th>Оптом(руб)</th>
            </thead>
            <tbody>
                {% for product_revise in revise.products_revise.all %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ product_revise.product.product_kind.product_category.product_group.group_name }}</td>
                        <td>{{ product_revise.product.product_kind.product_category.category_name }}</td>
                        <td>{{ product_revise.product.product_kind.kind_name }}</td>
                        <td>{{ product_revise.product.product_name }}</td>
                        <td>{{ product_revise.count_storage }}</td>
                        <td>{{ product_revise.count_revise }}</td>
                        <td>{{ product_revise.get_loss_cost_price }}</td>
                        <td>{{ product_revise.get_loss_retail_price }}</td>
                        <td>{{ product_revise.get_loss_shop_price }}</td>
                        <td>{{ product_revise.get_loss_wholesale_price }}</td>
                    </tr>
                {% endfor %}
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>Итого</td>
                    <td>{{ revise.get_revise_loss_cost_price }}</td>
                    <td>{{ revise.get_revise_loss_retail_price }}</td>
                    <td>{{ revise.get_revise_loss_shop_price }}</td>
                    <td>{{ revise.get_revise_loss_wholesale_price }}</td>
                </tr>
            </tbody>
        </table>
        <form action="{% url 'revise_delete_view' revise.id %}" method="post">
            {% csrf_token %}
            <input type="submit" value="Отменить сверку">
        </form>
        <form action="{% url 'revise_change_view' revise.id%}" method="post">
            {% csrf_token %}
            <input type="submit" value="Подтвердить сверку">
        </form>
    {% endif %}
{% endblock %}